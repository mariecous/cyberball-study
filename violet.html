<!DOCTYPE html>
<html lang="fr">
<head>
 <meta charset="utf-8" />
  <title>Cyberball - version interactive (avec avatars)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: "Helvetica Neue", Arial, sans-serif; text-align: center; background: #f2f2f2; margin: 0; padding: 20px; }
    #container { max-width: 900px; margin: 0 auto; }
    canvas { border: 2px solid #444; background: #fff; margin-top: 20px; display:block; margin-left:auto; margin-right:auto; }
    .hidden { display: none; }
    button { margin: 10px; padding: 10px 20px; font-size: 16px; border-radius: 8px; border: none; background: #007bff; color: white; cursor: pointer; }
    #loading { margin-top: 20px; padding: 30px; background: #fff; display: inline-block; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    #status { font-size: 14px; color:#555; margin-top:8px; }
    #questionnaire { margin-top: 20px; background: #fff; padding: 20px; border-radius: 10px; display: inline-block; box-shadow: 0 4px 12px rgba(0,0,0,0.06); }
    label { display:block; margin-top:10px; text-align:left; }
    input[type="range"] { width: 300px; }
    #debrief { margin-top: 20px; }
  </style>
</head>
<body>

<h1>CYBERBALL</h1>
<p id="instructions">Vous allez jouer avec deux autres participants virtuels. Cliquez sur "Commencer" pour débuter.</p>
<button id="startBtn">Commencer</button>
  
<div id="loading" class="hidden" role="status" aria-live="polite">
      <h3>Recherche des autres joueurs en ligne...</h3>
      <div id="status">Connexion en cours<span id="dots">...</span></div>
    </div>
  
<canvas id="gameCanvas" width="600" height="400" class="hidden"></canvas>

<div id="questionnaire" class="hidden">
  <h2>Questionnaire rapide</h2>
  <p>1. Je me suis senti(e) exclu(e) pendant le jeu :</p>
  <input type="range" id="q1" min="1" max="11" value="4"><br>
  <p>2. J’ai ressenti de la détresse pendant le jeu :</p>
  <input type="range" id="q2" min="1" max="11" value="4"><br>
  <p>3. Je pense que les autres joueurs m’appréciaient :</p>
  <input type="range" id="q3" min="1" max="11" value="4"><br>
  <button id="finishBtn">Terminer</button>
</div>

<div id="debrief" class="hidden">
  <h2>Débriefing</h2>
  <p>Merci pour votre participation !</p>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const startBtn = document.getElementById("startBtn");
const questionnaire = document.getElementById("questionnaire");
const finishBtn = document.getElementById("finishBtn");
const debrief = document.getElementById("debrief");

const players = [
  { x: 100, y: 200, name: "Joueur 1" },
  { x: 300, y: 60, name: "Vous", isSelf: true },
  { x: 500, y: 200, name: "Joueur 2" }
];

let ball = { x: players[0].x, y: players[0].y };
let hasBall = false;
let current = 0;
let throws = 0;
const TOTAL_THROWS = 20;
const EXCLUSION_RATE = 0.5; // 0 = inclusion, 0.8 = exclusion (rarement la balle)

function drawPlayers() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  players.forEach(p => {
    ctx.beginPath();
    ctx.arc(p.x, p.y, 35, 0, 2*Math.PI);
    ctx.fillStyle = p.isSelf ? "#007bff" : "#777";
    ctx.fill();
    ctx.fillStyle = "white";
    ctx.font = "14px sans-serif";
    ctx.fillText(p.name, p.x - 25, p.y + 5);
  });
  // balle
  ctx.beginPath();
  ctx.arc(ball.x, ball.y, 10, 0, 2*Math.PI);
  ctx.fillStyle = "orange";
  ctx.fill();
}

function throwBall(from, to, callback) {
  const steps = 50;
  let t = 0;
  const dx = (players[to].x - players[from].x)/steps;
  const dy = (players[to].y - players[from].y)/steps;
  const interval = setInterval(() => {
    ball.x += dx;
    ball.y += dy;
    drawPlayers();
    t++;
    if (t >= steps) {
      clearInterval(interval);
      current = to;
      callback();
    }
  }, 50);
}

function nextThrow() {
  throws++;
  if (throws > TOTAL_THROWS) {
    canvas.classList.add("hidden");
    questionnaire.classList.remove("hidden");
    return;
  }

  // si c’est à l’utilisateur
  if (players[current].isSelf) {
    hasBall = true;
  } else {
    hasBall = false;
    // déterminer si les bots te passent la balle ou pas
    const passToYou = Math.random() > EXCLUSION_RATE;
    let to;
    if (passToYou) {
      to = 1; // toi
    } else {
      to = current === 0 ? 2 : 0; // entre eux
    }
    throwBall(current, to, () => {
      current = to;
      if (players[to].isSelf) {
        hasBall = true;
      }
      setTimeout(nextThrow, hasBall ? 0 : 800);
    });
  }
}

// clic pour lancer la balle
canvas.addEventListener("click", e => {
  if (!hasBall) return;
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  // trouver joueur le plus proche du clic
  let clicked = null;
  players.forEach((p, i) => {
    if (!p.isSelf) {
      const dist = Math.hypot(p.x - x, p.y - y);
      if (dist < 40) clicked = i;
    }
  });
  if (clicked !== null) {
    hasBall = false;
    throwBall(1, clicked, () => {
      current = clicked;
      setTimeout(nextThrow, 800);
    });
  }
});

startBtn.onclick = () => {
  startBtn.classList.add("hidden");
  canvas.classList.remove("hidden");
  drawPlayers();
  setTimeout(() => nextThrow(), 1000);
};

finishBtn.onclick = () => {
  questionnaire.classList.add("hidden");
  debrief.classList.remove("hidden");
};
</script>

</body>
</html>





